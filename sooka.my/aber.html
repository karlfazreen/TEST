<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudTV - Shaka Player Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.min.js"></script>
    <style>
        body {
            background-color: black;
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #video-container {
            position: relative;
            display: inline-block;
        }
        #video {
            width: 80%;
            max-width: 1280px;
            height: auto;
        }
        #overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.5);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video" controls autoplay></video>
        <div id="overlay">CloudTV</div>
    </div>
    <br>
    <label for="resolution">Pilih Resolusi:</label>
    <select id="resolution"></select>
    <br>
    <label for="subtitles">Pilih Sarikata:</label>
    <select id="subtitles"></select>
    
    <script>
        function xorEncryptDecrypt(input, key) {
            let output = '';
            for (let i = 0; i < input.length; i++) {
                output += String.fromCharCode(input.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return btoa(output);
        }
        
        const encryptedKeys = {
            key1: xorEncryptDecrypt('c15541e4dde34c48a0d144a4b0ab7194:ce82e3d81126183e5a262e320f6348b3', 'mysecretkey'),
            key2: xorEncryptDecrypt('d5249cb40505495494828f42c37087cb:d59f6a7bed00bd5348355ab5b3ee6aa0', 'mysecretkey')
        };
        
        async function initPlayer() {
            const manifestUri = "https://l16.dp.sooka.my/1004/linear/index.mpd";
            const bearerToken = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ3bXZlciI6Miwid21pZGZtdCI6ImFzY2lpIiwid21pZHR5cCI6MSwid21rZXl2ZXIiOjEsIndtaWRsZW4iOjUxMiwid21pZCI6Ik5EVmtZVGN4T0RBdFpEa3pNeTAwWldZNUxUaGhZVFV0WVRrMlpXUTFNVGM1WTJSbSIsIndtb3BpZCI6MzIsImV4cCI6MTczOTc1MjA0NCwiaWF0IjoxNzM5MTQ4MDQ0fQ.bQr7YuBzR3JVRs2PuBK5V7_d4P7VF4iPOqaPm0Qrvxo";
            
            function xorDecrypt(input, key) {
                let decoded = atob(input);
                let output = '';
                for (let i = 0; i < decoded.length; i++) {
                    output += String.fromCharCode(decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length));
                }
                return output.split(':');
            }
            
            const decryptedKey1 = xorDecrypt(encryptedKeys.key1, 'mysecretkey');
            const decryptedKey2 = xorDecrypt(encryptedKeys.key2, 'mysecretkey');
            
            const licenseServer = {
                'org.w3.clearkey': {
                    'serverURL': '',
                    'clearkeys': {
                        [decryptedKey1[0]]: decryptedKey1[1],
                        [decryptedKey2[0]]: decryptedKey2[1]
                    }
                }
            };
            
            shaka.polyfill.installAll();
            const video = document.getElementById('video');
            const player = new shaka.Player(video);
            player.configure({ 
                drm: licenseServer,
                networkingEngine: player.getNetworkingEngine()
            });
            
            player.getNetworkingEngine().registerRequestFilter((type, request) => {
                if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
                    request.headers['Authorization'] = bearerToken;
                    request.headers['User-Agent'] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36";
                }
            });
            
            try {
                await player.load(manifestUri);
                console.log('The video has been loaded successfully!');
            } catch (error) {
                console.error('Error loading video:', error);
            }
        }
        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
